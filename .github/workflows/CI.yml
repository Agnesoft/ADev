name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    name: ${{matrix.config.name}}
    runs-on: ${{matrix.config.runner}}
    strategy:
      fail-fast: false
      matrix:
        config:
        - {
            name: "Ubuntu Latest GCC",
            runner: ubuntu-latest,
            environment: "",
            ninja: linux,
            cc: gcc-9,
            cxx: g++-9
          }
        - {
            name: "Windows Latest MSVC",
            runner: windows-latest,
            environment: 'cmd /c "C:\Progra~2\Micros~1\2019\Enterprise\VC\Auxiliary\Build\vcvars64.bat & bash.exe"',
            ninja: win,
            cc: cl,
            cxx: cl
          }
        - {
            name: "macOS Latest Clang",
            runner: macos-latest,
            environment: "",
            ninja: mac,
            cc: clang,
            cxx: clang++
          }
    steps:
    - uses: actions/checkout@v2
    - name: Prepare Environment
      run: |
        ${{matrix.config.environment}}
        mkdir build
        cd build
        curl -L -o ninja.zip https://github.com/ninja-build/ninja/releases/download/v1.10.0/ninja-${{matrix.config.ninja}}.zip
        unzip ninja.zip
      
    - name: Generate Build
      run: |
        ${{matrix.config.environment}}
        export PATH=.:$PATH
        export CC=${{matrix.config.cc}}
        export CXX=${{matrix.config.cxx}}
        cd build
        cmake .. -GNinja -D CMAKE_BUILD_TYPE=Release
        
    - name: Build
      run: |
        ${{matrix.config.environment}}
        cd build
        ./ninja
